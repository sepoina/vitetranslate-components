(function(i,u){typeof exports=="object"&&typeof module<"u"?u(exports,require("react"),require("path"),require("fs")):typeof define=="function"&&define.amd?define(["exports","react","path","fs"],u):(i=typeof globalThis<"u"?globalThis:i||self,u(i["@sepoina/vitetranslate-components"]={},i.React,i.path,i.fs))})(this,function(i,u,p,g){"use strict";const _=u.createContext(null),S={langID:null};function x({predefined:e,children:a}){const[t,n]=u.useState(e),[r,o]=u.useState(null),s=l=>{n(l)};return u.useEffect(()=>{if(!t||S.langID===t)return;S.langID=t,(async()=>{try{const c=await(await fetch(`./locale/${t}.json`)).json();o({id:t,table:c,setNewLanguage:s})}catch{console.log(`Errore nel file locale/${t}.json `),n(e);return}})().catch(console.error)},[t]),u.createElement(_.Provider,{value:r},a)}function y({"data-translate":e,t:a,c:t,a:n,children:r}){const o=u.useContext(_);return u.useMemo(()=>{var l;let s=t||a||r;if(!e){const f=s.match(/_<_(.*?)_\/_(.*?)_>_/);if(f)e=f[1],s=f[2];else throw"errore nel servizio di traduzione, manca translate"}return(l=o==null?void 0:o.table)!=null&&l[e]?u.createElement("span",{"data-from-translate":e},n?b(o.table[e],n):o.table[e]):u.createElement("span",{"data-not-translate":e},n?b(s,n):s)},[o,n])}function b(e,a){if(a===void 0)return e;const t=Array.isArray(a)?a:[a];let n=0;return e.replace(/%s/g,()=>t[n++])}function E(e){var a,t,n;if(((t=(a=e==null?void 0:e.container)==null?void 0:a.children)==null?void 0:t.length)===1){const r=e.container.children[0];return r.type==="JSXText"?r.value:r.type==="JSXExpressionContainer"&&((n=r==null?void 0:r.expression)!=null&&n.value)?r.expression.value:!1}return!1}function w(e,a){var n,r,o,s;const t=a.node.attributes.find(l=>{var f;return((f=l==null?void 0:l.name)==null?void 0:f.name)===e});return t?((n=t==null?void 0:t.value)==null?void 0:n.type)==="StringLiteral"?t.value.value:((r=t==null?void 0:t.value)==null?void 0:r.type)==="JSXExpressionContainer"&&((s=(o=t==null?void 0:t.value)==null?void 0:o.expression)==null?void 0:s.type)==="StringLiteral"?t.value.expression.value:!1:!1}function L(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var v={exports:{}};(function(e,a){Object.defineProperty(a,"__esModule",{value:!0}),t.BASE=2166136261;function t(n,r=t.BASE){const o=n.length;for(let s=0;s<o;s++)r^=n.charCodeAt(s),r+=(r<<1)+(r<<4)+(r<<7)+(r<<8)+(r<<24);return r>>>0}a.default=t,e.exports=t})(v,v.exports);var C=v.exports;const A=L(C);function T(e,a){var r,o;if(!((r=e==null?void 0:e.node)!=null&&r.value)||!/_%_(.*?)_%_/.test(e.node.value))return;const t=(o=/_%_(.*?)_%_/.exec(e.node.value))==null?void 0:o[1];if(!t)return;const n=m(t,a);e.node.value=h(e.node.value,n,t),e.node.extra.rawValue&&(e.node.extra.rawValue=h(e.node.extra.rawValue,n,t)),e.node.extra.raw&&(e.node.extra.raw=h(e.node.extra.raw,n,t))}function h(e,a,t){const n=`_<_${a}_/_${t}_>_`;return e.replace(/_%_(.*?)_%_/,n)}function m(e,a){const t=p.parse(a.filename).name,n=A(e).toString(36),r=`${t}_${n}`;return globalThis.TranslateService.baseLng[r]=e,r}const D=e=>{const{types:a}=e;return{visitor:{StringLiteral:T,JSXText:T,TemplateElement:T,JSXOpeningElement(t,n){if(t.node.name.name!=="Translate"||t.node.attributes.find(c=>{var d;return((d=c==null?void 0:c.name)==null?void 0:d.name)==="data-translate"})||t.node.attributes.find(c=>(c==null?void 0:c.name.name)==="c"))return;const s=t.node.attributes.find(c=>{var d;return((d=c==null?void 0:c.name)==null?void 0:d.name)==="t"})?w("t",t):E(t);if(s===!1)throw"Errore, Translate deve contenere solo stringhe";const l=m(s,n),f=a.jSXAttribute(a.jSXIdentifier("data-translate"),a.stringLiteral(l));t.node.attributes.push(f)}}}};function $(e){return{name:"onRollupTranslate",buildStart:{sequential:!0,order:"pre",handler:()=>{globalThis.TranslateService=e,globalThis.TranslateService.baseLng={__lngVersion__:P()},console.log("Preparo il servizio traduzioni.")}},buildEnd:{sequential:!0,order:"post",handler:()=>{j()}}}}function j(){const e=globalThis.TranslateService.file,a=globalThis.TranslateService.dist;console.log("TRANSLATE ---------------------------------------------"),console.log("Carico traduzione base.");try{g.readFile(e,"utf8",(t,n)=>{let r={newest:!0,changed:!0},o=null;if(t)console.log(`Non esiste ancora il file ${e}, tento di crearlo`),o=globalThis.TranslateService.baseLng;else{o=JSON.parse(n);const s=globalThis.TranslateService.baseLng;r=N(o,s)}if(r.changed){const s=r.newest?"Nuovo file,":`(${r.added} agginte, ${r.deleted} rimosse)`;console.log(`Update avvenuto: ${s} salvo.`),g.writeFile(e,JSON.stringify(o,null,2),"utf8",l=>{l?console.error(`Errore durante la scrittura su ${e}`,l):(console.log(`Dati scritti con successo su ${e}`),g.copyFile(e,a,f=>{f||console.log(`Copiato con successo su ${a}`),console.log("END TRANSLATE ---------------------------------------------")}))})}else console.log("Nessun cambiamento."),console.log("END TRANSLATE ---------------------------------------------")})}catch(t){console.error(`Errore l'elaborazione di ${e}, cancellalo`,t);return}}function N(e,a){const t={changed:!1,deleted:0,added:0};for(const n in e)n in a||(delete e[n],t.changed=!0,t.deleted+=1);for(const n in a)n in e||(e[n]=a[n],t.changed=!0,t.added+=1);return t.changed&&(e.__lngVersion__=a.__lngVersion__),t}function P(){return Date.now()}i.Translate=y,i.TranslateContainer=x,i.TranslateContext=_,i.babelTranslate=D,i.rollupTranslate=$,Object.defineProperty(i,Symbol.toStringTag,{value:"Module"})});
//# sourceMappingURL=index.umd.cjs.map
