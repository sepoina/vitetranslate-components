{"version":3,"file":"index.js","sources":["../src/components/TranslateContext.jsx","../src/components/TranslateContainer.jsx","../src/components/Translate.jsx"],"sourcesContent":["import { createContext } from \"react\";\nexport const TranslateContext = createContext(null);","import React from \"react\";\r\nimport { TranslateContext } from \"./TranslateContext\";\r\n\r\nconst last = { langID: null };\r\n\r\nexport default function TranslateContainer({ predefined, children }) {\r\n  const [propose, setPropose] = React.useState({ lang: predefined });\r\n  const [langOBJ, setLangOBJ] = React.useState(null);\r\n\r\n  // struttura funzione proposeNewLanguage({\r\n  //   lang:'it',\r\n  //   onStart: () => {},      // a inizio caricamento\r\n  //   onDone: (isOk) => {},   // a fine caricamento isOk - true o false\r\n  //   onError: (error) => {}, // in caso di errore, struttura error\r\n  //  })\r\n  const proposeNewLanguage = propObj => {\r\n    setPropose(propObj);\r\n  };\r\n\r\n  React.useEffect(() => {\r\n    if (!propose.lang) return;\r\n    if (last.langID === propose.lang) return; // già in caricamento\r\n    last.langID = propose.lang; // evita doppie interazioni\r\n    if (propose.onStart) propose.onStart(true);\r\n    // declare the async data fetching function\r\n    const fetchData = async () => {\r\n      try {\r\n        // get the data from the api\r\n        // console.log(\"Carico:\", propose.lang);\r\n        const response = await fetch(`./locale/${propose.lang}.json`);\r\n        // convert the data to json\r\n        const json = await response.json();\r\n        // set state with the result\r\n        // console.log(\"Fatto.\");\r\n        if (propose.onDone) propose.onDone(true);\r\n        setLangOBJ({\r\n          id: propose.lang,\r\n          table: json,\r\n          proposeNewLanguage: proposeNewLanguage,\r\n        });\r\n      } catch (error) {\r\n        if (propose.onError) propose.onError({error:error, inexistID:propose.lang});\r\n        else console.error(`Inexistant or error in language file ./locale/${propose.lang}.json `);\r\n        if (propose.onDone) propose.onDone(false);\r\n        // setPropose({ lang: predefined });\r\n        return;\r\n      }\r\n    };\r\n\r\n    // call the function\r\n    fetchData();\r\n  }, [propose.lang]);\r\n\r\n  return (\r\n    <TranslateContext.Provider value={langOBJ}>\r\n      {children}\r\n    </TranslateContext.Provider>\r\n  );\r\n}\r\n","/* eslint-disable react-hooks/exhaustive-deps */\r\nimport React from \"react\";\r\nimport { useContext, useMemo } from \"react\";\r\nimport { TranslateContext } from \"./TranslateContext\";\r\n/**\r\n * t -> testo da mostrare\r\n * a -> array di campi che iniettano il testo da mostrare \r\n * c -> testo da costante javascript iniettata \r\n * children -> eventuali figli\r\n */\r\nexport default function Translate({ 'data-translate': dataTranslate, t, c, a, children }) {\r\n    const lang = useContext(TranslateContext);\r\n    //\r\n    // evita il rendering se non cambia lingua o array di dati\r\n    return useMemo(() => {\r\n        let inputString = c || t || children;\r\n        // console.log(\"rerender:\", inputString);\r\n        //\r\n        // non c'è dataTranslate, può essere che sia inlinea, se lo è è nel parametro c\r\n        if (!dataTranslate || (inputString.startsWith(\"_<_\") && inputString.endsWith(\"_>_\"))) {\r\n            const matches = inputString.match(/_<_(.*?)_\\/_(.*?)_>_/);\r\n            if (matches) {\r\n                dataTranslate = matches[1]; // Contenuto tra \"_<_\" e \"_/_\"\r\n                inputString = matches[2]; // Contenuto tra \"_/_\" e \"_>_\"\r\n            }\r\n            else {\r\n                throw \"errore nel servizio di traduzione, manca translate\";\r\n            }\r\n        }\r\n        //\r\n        // c'è traduzione\r\n        if (lang?.table?.[dataTranslate]) return (\r\n            <span data-from-translate={dataTranslate}>\r\n                {a ? sostitui(lang.table[dataTranslate], a) : lang.table[dataTranslate]}\r\n            </span>\r\n        )\r\n        //\r\n        // non c'è traduzione\r\n        return (\r\n            <span data-not-translate={dataTranslate}>\r\n                {a ? sostitui(inputString, a) : inputString}\r\n            </span>\r\n        )\r\n    }, [lang,a]); // solo il cambio di lingua e di array obbliga il re-rendering \r\n}\r\n\r\n//\r\n// filla le variabili nel template\r\n//     es: text='Siamo al:%0/%1' e ['20%','100%']\r\n//              'Siamo al:%0' e '20%'\r\n//\r\nfunction sostitui(text, args) {\r\n    // se non ci sono argomenti torna sè stesso \r\n    if (args === undefined) return text;\r\n    // definisce il contenitore\r\n    const list = Array.isArray(args) ? args : [args]; // se args[0] è un array è lui la lista sennò lo mette in un array monoelemento   \r\n\r\n    let counter = 0;\r\n    const replacedString = text.replace(/%s/g, () => list[counter++]);\r\n    return replacedString;\r\n    /*\r\n    // log(text, args);\r\n    // https://stackoverflow.com/questions/610406/javascript-equivalent-to-printf-string-format#\r\n    // var args = Array.prototype.slice.call(arguments, 1);\r\n    return text.replace(/%(\\d+)/g, function (match, number) {\r\n        return typeof list[number] != 'undefined'\r\n            ? list[number]\r\n            : match\r\n            ;\r\n    });*/\r\n}"],"names":["TranslateContext","createContext","last","TranslateContainer","predefined","children","propose","setPropose","React","langOBJ","setLangOBJ","proposeNewLanguage","propObj","json","error","Translate","dataTranslate","t","c","a","lang","useContext","useMemo","inputString","matches","_a","sostitui","text","args","list","counter"],"mappings":";AACa,MAAAA,IAAmBC,EAAc,IAAI,GCE5CC,IAAO,EAAE,QAAQ;AAEvB,SAAwBC,EAAmB,EAAE,YAAAC,GAAY,UAAAC,KAAY;AAC7D,QAAA,CAACC,GAASC,CAAU,IAAIC,EAAM,SAAS,EAAE,MAAMJ,EAAA,CAAY,GAC3D,CAACK,GAASC,CAAU,IAAIF,EAAM,SAAS,IAAI,GAQ3CG,IAAqB,CAAWC,MAAA;AACpC,IAAAL,EAAWK,CAAO;AAAA,EAAA;AAGpB,SAAAJ,EAAM,UAAU,MAAM;AAEhB,QADA,CAACF,EAAQ,QACTJ,EAAK,WAAWI,EAAQ;AAAM;AAClC,IAAAJ,EAAK,SAASI,EAAQ,MAClBA,EAAQ,WAASA,EAAQ,QAAQ,EAAI,IAEvB,YAAY;AACxB,UAAA;AAKI,cAAAO,IAAO,OAFI,MAAM,MAAM,YAAYP,EAAQ,IAAI,OAAO,GAEhC;AAG5B,QAAIA,EAAQ,UAAQA,EAAQ,OAAO,EAAI,GAC5BI,EAAA;AAAA,UACT,IAAIJ,EAAQ;AAAA,UACZ,OAAOO;AAAA,UACP,oBAAAF;AAAA,QAAA,CACD;AAAA,eACMG,GAAO;AACd,QAAIR,EAAQ,UAASA,EAAQ,QAAQ,EAAC,OAAAQ,GAAa,WAAUR,EAAQ,MAAK,IACrE,QAAQ,MAAM,iDAAiDA,EAAQ,IAAI,QAAQ,GACpFA,EAAQ,UAAQA,EAAQ,OAAO,EAAK;AAExC;AAAA,MACF;AAAA,IAAA;EAIQ,GACT,CAACA,EAAQ,IAAI,CAAC,mCAGdN,EAAiB,UAAjB,EAA0B,OAAOS,KAC/BJ,CACH;AAEJ;AChDwB,SAAAU,EAAU,EAAE,kBAAkBC,GAAe,GAAAC,GAAG,GAAAC,GAAG,GAAAC,GAAG,UAAAd,KAAY;AAChF,QAAAe,IAAOC,EAAWrB,CAAgB;AAGxC,SAAOsB,EAAQ,MAAM;;AACb,QAAAC,IAAcL,KAAKD,KAAKZ;AAIxB,QAAA,CAACW,KAAkBO,EAAY,WAAW,KAAK,KAAKA,EAAY,SAAS,KAAK,GAAI;AAC5E,YAAAC,IAAUD,EAAY,MAAM,sBAAsB;AACxD,UAAIC;AACA,QAAAR,IAAgBQ,EAAQ,CAAC,GACzBD,IAAcC,EAAQ,CAAC;AAAA;AAGjB,cAAA;AAAA,IAEd;AAGI,YAAAC,IAAAL,KAAA,gBAAAA,EAAM,UAAN,QAAAK,EAAcT,KACb,gBAAAR,EAAA,cAAA,QAAA,EAAK,uBAAqBQ,EAAA,GACtBG,IAAIO,EAASN,EAAK,MAAMJ,CAAa,GAAGG,CAAC,IAAIC,EAAK,MAAMJ,CAAa,CAC1E,IAKA,gBAAAR,EAAA,cAAC,UAAK,sBAAoBQ,EAAA,GACrBG,IAAIO,EAASH,GAAaJ,CAAC,IAAII,CACpC;AAAA,EAAA,GAEL,CAACH,GAAKD,CAAC,CAAC;AACf;AAOA,SAASO,EAASC,GAAMC,GAAM;AAE1B,MAAIA,MAAS;AAAkB,WAAAD;AAE/B,QAAME,IAAO,MAAM,QAAQD,CAAI,IAAIA,IAAO,CAACA,CAAI;AAE/C,MAAIE,IAAU;AAEP,SADgBH,EAAK,QAAQ,OAAO,MAAME,EAAKC,GAAS,CAAC;AAYpE;"}